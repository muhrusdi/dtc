{"dependencies":[{"name":"./BlockMapBuilder","loc":{"line":16,"column":30}},{"name":"./generateRandomKey","loc":{"line":18,"column":32}},{"name":"./insertIntoList","loc":{"line":19,"column":29}},{"name":"fbjs/lib/invariant","loc":{"line":20,"column":24}}],"generated":{"js":"/**\n * Copyright (c) 2013-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @providesModule insertFragmentIntoContentState\n * @typechecks\n * \n */\n\n'use strict';\n\nvar BlockMapBuilder = require('./BlockMapBuilder');\n\nvar generateRandomKey = require('./generateRandomKey');\nvar insertIntoList = require('./insertIntoList');\nvar invariant = require('fbjs/lib/invariant');\n\nfunction insertFragmentIntoContentState(contentState, selectionState, fragment) {\n  !selectionState.isCollapsed() ? \"development\" !== 'production' ? invariant(false, '`insertFragment` should only be called with a collapsed selection state.') : invariant(false) : void 0;\n\n  var targetKey = selectionState.getStartKey();\n  var targetOffset = selectionState.getStartOffset();\n\n  var blockMap = contentState.getBlockMap();\n\n  var fragmentSize = fragment.size;\n  var finalKey;\n  var finalOffset;\n\n  if (fragmentSize === 1) {\n    var targetBlock = blockMap.get(targetKey);\n    var pastedBlock = fragment.first();\n    var text = targetBlock.getText();\n    var chars = targetBlock.getCharacterList();\n\n    var newBlock = targetBlock.merge({\n      text: text.slice(0, targetOffset) + pastedBlock.getText() + text.slice(targetOffset),\n      characterList: insertIntoList(chars, pastedBlock.getCharacterList(), targetOffset),\n      data: pastedBlock.getData()\n    });\n\n    finalKey = targetKey;\n    finalOffset = targetOffset + pastedBlock.getText().length;\n\n    return contentState.merge({\n      blockMap: blockMap.set(targetKey, newBlock),\n      selectionBefore: selectionState,\n      selectionAfter: selectionState.merge({\n        anchorKey: finalKey,\n        anchorOffset: finalOffset,\n        focusKey: finalKey,\n        focusOffset: finalOffset,\n        isBackward: false\n      })\n    });\n  }\n\n  var newBlockArr = [];\n\n  contentState.getBlockMap().forEach(function (block, blockKey) {\n    if (blockKey !== targetKey) {\n      newBlockArr.push(block);\n      return;\n    }\n\n    var text = block.getText();\n    var chars = block.getCharacterList();\n\n    // Modify head portion of block.\n    var blockSize = text.length;\n    var headText = text.slice(0, targetOffset);\n    var headCharacters = chars.slice(0, targetOffset);\n    var appendToHead = fragment.first();\n\n    var modifiedHead = block.merge({\n      text: headText + appendToHead.getText(),\n      characterList: headCharacters.concat(appendToHead.getCharacterList()),\n      type: headText ? block.getType() : appendToHead.getType(),\n      data: appendToHead.getData()\n    });\n\n    newBlockArr.push(modifiedHead);\n\n    // Insert fragment blocks after the head and before the tail.\n    fragment.slice(1, fragmentSize - 1).forEach(function (fragmentBlock) {\n      newBlockArr.push(fragmentBlock.set('key', generateRandomKey()));\n    });\n\n    // Modify tail portion of block.\n    var tailText = text.slice(targetOffset, blockSize);\n    var tailCharacters = chars.slice(targetOffset, blockSize);\n    var prependToTail = fragment.last();\n    finalKey = generateRandomKey();\n\n    var modifiedTail = prependToTail.merge({\n      key: finalKey,\n      text: prependToTail.getText() + tailText,\n      characterList: prependToTail.getCharacterList().concat(tailCharacters),\n      data: prependToTail.getData()\n    });\n\n    newBlockArr.push(modifiedTail);\n  });\n\n  finalOffset = fragment.last().getLength();\n\n  return contentState.merge({\n    blockMap: BlockMapBuilder.createFromArray(newBlockArr),\n    selectionBefore: selectionState,\n    selectionAfter: selectionState.merge({\n      anchorKey: finalKey,\n      anchorOffset: finalOffset,\n      focusKey: finalKey,\n      focusOffset: finalOffset,\n      isBackward: false\n    })\n  });\n}\n\nmodule.exports = insertFragmentIntoContentState;"},"hash":"96191b0038539b2164181525268783aa"}